# Makefile.in - 20.5.2008 - 19.7.2008 Ari & Tero Roponen

# TODO: file_types.c must be recompiled if configure-options are changed

DEBUG=
CFLAGS=$(shell pkg-config --cflags poppler-glib) -Os -D_GNU_SOURCE -std=gnu99 $(DEBUG)
LIBS=$(shell pkg-config --libs poppler-glib) -lmagic

EXTRA_INCLUDES=@EXTRA_INCLUDES@
EXTRA_LIBS=@EXTRA_LIBS@
CFLAGS += $(EXTRA_INCLUDES)
LIBS += $(EXTRA_LIBS)

all: oma

.PHONY: clean
clean:
	rm -f oma *.o

# These are compiled always
C_FILES=commands.c document.c extcmd.c file_info.c \
	keymap.c main.c pixbuf.c readline.c terminal.c util.c \
	text.c x11canvas.c djvu.c ps.c pdf.c

# Keep these up-to-date
commands.o: commands.c commands.h document.h extcmd.h keymap.h util.h
djvu.o: djvu.c document.h file_info.h
document.o: document.c document.h file_info.h
extcmd.o: extcmd.c document.h extcmd.h
fbcanvas.o: fbcanvas.c document.h file_info.h
file_info.o: file_info.c file_info.h
keymap.o: keymap.c keymap.h
main.o: main.c document.h commands.h extcmd.h keymap.h terminal.h
pdf.o: pdf.c document.h file_info.h util.h
pixbuf.o: pixbuf.c document.h file_info.h
ps.o: ps.c document.h file_info.h
readline.o: readline.c document.h keymap.h terminal.h
terminal.o: terminal.c document.h keymap.h
text.o: text.c document.h extcmd.h file_info.h keymap.h util.h
util.o: util.c util.h
x11canvas.o: x11canvas.c commands.h util.h

OBJ_FILES:=$(C_FILES:.c=.o)

oma: $(OBJ_FILES)
	$(CC) $(CFLAGS) -o $@ $^ $(LIBS)
